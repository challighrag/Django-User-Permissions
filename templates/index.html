<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
</head>
<body>
  <h1>Manage Your Tasks</h1>

  {% if token %}
    <h3>Welcome: {{ user.first_name }}</h3>
    <h3>Your Token: {{ token }}</h3>
    <form method="POST">
      {% csrf_token %}
      <button type="submit" name="action" value="logout">Logout</button>
    </form>
  {% endif %}

  <div class="section">
    <h2>Add Task</h2>
    <form method="POST">
      {% csrf_token %}
      <input type="number" name="user_ID" placeholder="User - ID" required>
      <input type="text" name="task_name" placeholder="Task" required>
      <input type="text" name="description" placeholder="Description">
      <button type="submit" name="action" value="add_task">Add Task</button>
    </form>
    {% if message %}
      <p>{{ message }}</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Search Users and see  Tasks</h2>
    <form method="GET">
      <input type="text" name="search" placeholder="Search" value="{{ query }}">
      <button type="submit">Search</button>
    </form>

    {% if user_found %}
      {% for user in user_found %}
        <div class="user-card">
          <h3>{{ user.first_name }} {{ user.last_name }} (Age: {{ user.age }})</h3>
          <h4>Tasks:</h4>
          <ul>
            {% for task in tasks %}
              {% if task.user_id == user.id %}
                <li>{{ task.title }} â€” {{ task.description }}</li>
              {% endif %}
            {% empty %}
              <li>No tasks</li>
            {% endfor %}
          </ul>
        </div>
      {% endfor %}
    {% elif query %}
      <p>No users found for "{{ query }}"</p>
    {% endif %}
  </div>

</body>
</html>